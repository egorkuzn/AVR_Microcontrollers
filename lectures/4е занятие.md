# Ввод/вывод с использованием портов ввода вывода.

Используются для обмена с внешним миром. Высокий 5 Вольт == 1. ПОрты имеют вспомогательную функцию.
* Тактирование
* Внешние прерывания
* Px/Rx (RS322. Пример: COM Port)
* ACP 

Правило: есть описание, есть регистры настройки. Всю стек, память (если с ней работаешь), порты, нужно инициализировать.
Где картинка с микроконтроллером: в скобочках доп функции описаны. GND - земля. PD-PC (все на Р) - порты.

По входу конероллер может держать высоко импедансно (что подали, то выставили), либо в подтянутом состоянии (если выставляет, то 0, если ничего не выставляет, то 1). Если нет подтяжки, то работает как антенна, ловит всё подряд. (см. таблицу 14-1). 

Нужно ждать PIN пока выставится. 

> На следующей лекции арифметика/адресация и пр.

DDR - направление, PORT - , PIN - сотояние на ножке ввод-вывод
# Широтно-импульсная модуляция.

Таймер-счётчик разберём. Но есть 16-битный таймер счётчик. Мы должны не забывать когда делаем обработку. Аппаратно он обеспечивает фикцсацию младшого байта в регистр, который нам недоступен. ПРи записи сначала старший байт, потом младший байт - без разбросов сразу. Иначе фиксация уходит и получится фигня без гарантий. Отключайте прерывание cli - clear interrapt,  sei - set interrapt.

Функция основная счёт. Мысчитаем в самом простом режиме от 0 275. Внешняя или системная частота. В зависимисти от модели микроконтроллера внешний или местный генератор. Если необходимо выждать больше, чем счётчик, то в режиме по переполнеию обраб. куда считываете, сколько было прерываний. Когда первый переполнится - ещё прибавлять.

Есть прерывание по захвату и ШИМ. 

По захвату. Есть соответствующая табличка. Таймеры-счётчики по захвату внешнего импульса: по спадающей, по нарастающей. И можем посчитать кол-во внешних импульсов, событий. Можем посчитать без программной логики, аппаратно. Можем реализовать частотомер. Проверять в своем и внешнем сколько кто насчитал. Можем друг относительно друга посчитать. Мы сильно зависим от разрядности счётчика и срабатывания на конце импульса. Т.е. один может выпасть или появиться.

> Регистр TIMSK 

По ШИМ. Лучше работать с 8-битным таймером-счётчиком. 
* Нормальный
* Сброс при совпадении
* Базово-корректный ШИМ. 

Таблица 15-6. Посмотрим на ножки ввода-вывода. OC0B-OC0A на них будет выведен сигнал. Перед использованием ШИМА:
* делитель
* биты прирывания
* записать биты ОСRA

 В нормальном режиме от 0 до 275. Там формируются формирования по переполнению. В режиме сравнения происходит генераци след. образом. Таблица 15-2. Т.е. на выход порт должен при выводе. Чтобы считать - порт на вход. TCCR0A, TCCR0B. Надо смотреть просто биты. 

 Рассмотрели CTC mode. 

 Режим быстрого ШИМ: от 0 до потолка, не прирывается, прерывание по сравнению.

 /\\/\\/\\/\\/\\ - тут переполнение в 0. Счёт вверх-вниз - период. Обновляется на максимуме OCR (прерывания). Флаг обрабатывания переполнения в минимуме. Схемы все смотреть в документации. 

 Мы будем работать либо с СТС, либо с быстрым ШИМом.

 Тable 15-8 - режимы ШИМ. 


50 процентов скважность ШИМ